{
    "info": {
        "name": "Foody API - Admin Flow (Automated)",
        "description": "**Automated Admin User Testing Collection**\n\nThis collection tests the complete admin workflow with automatic authentication.\n\n## Auto-Login\nThe collection automatically logs in as admin and updates the auth token for all subsequent requests.\n\n## Test Credentials\n- Email: admin@foody.com\n- Password: ChangeMe123!\n- Role: ADMIN\n\n## Execution Order\n1. Login (auto-saves token)\n2. User Management (list, view, update)\n3. Restaurant Management (create, update, delete)\n4. Menu Management (create, update, delete)\n5. Payment Methods\n6. Order Management (create, view, update status)\n7. Payment Processing\n8. Admin Queries (all users, all payments)\n\n## Usage\nRun the entire collection using Collection Runner for automated testing.\n\n**Version:** 1.0.0\n**Role:** ADMIN\n**Last Updated:** November 2025",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "auth": {
        "type": "bearer",
        "bearer": [
            {
                "key": "token",
                "value": "{{auth_token}}",
                "type": "string"
            }
        ]
    },
    "variable": [
        {
            "key": "baseUrl",
            "value": "http://localhost:4000",
            "type": "string",
            "description": "Base URL for the API server"
        },
        {
            "key": "graphql",
            "value": "{{baseUrl}}/graphql",
            "type": "string",
            "description": "GraphQL endpoint URL"
        },
        {
            "key": "auth_token",
            "value": "",
            "type": "string",
            "description": "JWT authentication token (automatically set after login)"
        },
        {
            "key": "admin_email",
            "value": "admin@foody.com",
            "type": "string",
            "description": "Admin login email address"
        },
        {
            "key": "admin_password",
            "value": "ChangeMe123!",
            "type": "string",
            "description": "Admin login password"
        },
        {
            "key": "user_id",
            "value": "",
            "type": "string",
            "description": "User ID for testing user management operations"
        },
        {
            "key": "restaurant_id",
            "value": "",
            "type": "string",
            "description": "Restaurant ID for testing restaurant operations"
        },
        {
            "key": "menu_item_id",
            "value": "",
            "type": "string",
            "description": "Menu item ID for testing menu operations"
        },
        {
            "key": "payment_method_id",
            "value": "",
            "type": "string",
            "description": "Payment method ID for testing payment operations"
        },
        {
            "key": "order_id",
            "value": "",
            "type": "string",
            "description": "Order ID for testing order operations"
        },
        {
            "key": "payment_id",
            "value": "",
            "type": "string",
            "description": "Payment ID for testing payment operations"
        }
    ],
    "item": [
        {
            "name": "01 - Login as Admin",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"Admin login successful\", function () {",
                            "    pm.response.to.have.status(200);",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.login).to.have.property('token');",
                            "    pm.expect(response.data.login.user.role).to.equal('ADMIN');",
                            "    ",
                            "    const token = response.data.login.token;",
                            "    pm.collectionVariables.set(\"auth_token\", token);",
                            "    console.log(\"âœ… Admin authenticated successfully\");",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "auth": {
                    "type": "noauth"
                },
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "mutation Login($input: LoginInput!) {\n  login(input: $input) {\n    token\n    user {\n      id\n      email\n      role\n    }\n  }\n}",
                        "variables": "{\n  \"input\": {\n    \"email\": \"{{admin_email}}\",\n    \"password\": \"{{admin_password}}\"\n  }\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "02 - Get Current User (Verify Admin)",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"Current user is admin\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.me.role).to.equal('ADMIN');",
                            "    console.log(\"âœ… Admin role verified\");",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "query Me {\n  me {\n    id\n    email\n    role\n    country\n  }\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "03 - Get All Users",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"Users list retrieved\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.users).to.be.an('array');",
                            "    if (response.data.users.length > 0) {",
                            "        const testUser = response.data.users.find(u => u.role !== 'ADMIN');",
                            "        if (testUser) {",
                            "            pm.collectionVariables.set(\"user_id\", testUser.id);",
                            "            console.log(\"âœ… Test user ID saved:\", testUser.id);",
                            "        }",
                            "    }",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "query Users($first: Int) {\n  users(first: $first) {\n    id\n    email\n    role\n    country\n    isActive\n  }\n}",
                        "variables": "{\n  \"first\": 20\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "04 - Get All Restaurants",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"Restaurants list retrieved\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.restaurants).to.be.an('array');",
                            "    if (response.data.restaurants.length > 0) {",
                            "        pm.collectionVariables.set(\"restaurant_id\", response.data.restaurants[0].id);",
                            "        console.log(\"âœ… Test restaurant ID saved:\", response.data.restaurants[0].id);",
                            "    }",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "query Restaurants {\n  restaurants {\n    id\n    name\n    country\n    city\n  }\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "05 - Create Restaurant",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"Restaurant created successfully\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.createRestaurant).to.have.property('id');",
                            "    pm.collectionVariables.set(\"restaurant_id\", response.data.createRestaurant.id);",
                            "    console.log(\"âœ… New restaurant created:\", response.data.createRestaurant.id);",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "mutation CreateRestaurant($input: CreateRestaurantInput!) {\n  createRestaurant(input: $input) {\n    id\n    name\n    country\n  }\n}",
                        "variables": "{\n  \"input\": {\n    \"name\": \"Test Restaurant - Admin\",\n    \"description\": \"Automated test restaurant\",\n    \"address\": \"123 Test Street\",\n    \"city\": \"Mumbai\",\n    \"country\": \"INDIA\",\n    \"phone\": \"+91-1234567890\",\n    \"email\": \"test@restaurant.com\"\n  }\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "06 - Get Menu Items",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"Menu items retrieved\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.menuItems).to.be.an('array');",
                            "    if (response.data.menuItems.length > 0) {",
                            "        pm.collectionVariables.set(\"menu_item_id\", response.data.menuItems[0].id);",
                            "        console.log(\"âœ… Test menu item ID saved:\", response.data.menuItems[0].id);",
                            "    }",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "query MenuItems {\n  menuItems {\n    id\n    name\n    price\n    restaurant {\n      id\n    }\n  }\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "07 - Create Menu Item",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"Menu item created\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.createMenuItem).to.have.property('id');",
                            "    pm.collectionVariables.set(\"menu_item_id\", response.data.createMenuItem.id);",
                            "    console.log(\"âœ… Menu item created:\", response.data.createMenuItem.id);",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "mutation CreateMenuItem($input: CreateMenuItemInput!) {\n  createMenuItem(input: $input) {\n    id\n    name\n    price\n  }\n}",
                        "variables": "{\n  \"input\": {\n    \"name\": \"Test Dish - Admin\",\n    \"description\": \"Automated test menu item\",\n    \"price\": 15.99,\n    \"category\": \"Test Category\",\n    \"restaurantId\": \"{{restaurant_id}}\"\n  }\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "08 - Create Payment Method",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"Payment method created\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.createPaymentMethod).to.have.property('id');",
                            "    pm.collectionVariables.set(\"payment_method_id\", response.data.createPaymentMethod.id);",
                            "    console.log(\"âœ… Payment method created:\", response.data.createPaymentMethod.id);",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "mutation CreatePaymentMethod($input: CreatePaymentMethodInput!) {\n  createPaymentMethod(input: $input) {\n    id\n    type\n    provider\n  }\n}",
                        "variables": "{\n  \"input\": {\n    \"type\": \"CREDIT_CARD\",\n    \"provider\": \"STRIPE\",\n    \"token\": \"tok_admin_test\"\n  }\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "09 - Create Order",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"Order created successfully\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.createOrder).to.have.property('id');",
                            "    pm.collectionVariables.set(\"order_id\", response.data.createOrder.id);",
                            "    console.log(\"âœ… Order created:\", response.data.createOrder.id);",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "mutation CreateOrder($input: CreateOrderInput!) {\n  createOrder(input: $input) {\n    id\n    totalAmount\n    status\n  }\n}",
                        "variables": "{\n  \"input\": {\n    \"items\": [\n      {\n        \"menuItemId\": \"{{menu_item_id}}\",\n        \"quantity\": 2\n      }\n    ],\n    \"deliveryAddress\": \"123 Admin Test Street, Mumbai\",\n    \"phone\": \"+91-9876543210\",\n    \"paymentMethodId\": \"{{payment_method_id}}\"\n  }\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "10 - Get All Orders",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"Orders list retrieved\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.orders).to.be.an('array');",
                            "    console.log(\"âœ… Retrieved\", response.data.orders.length, \"orders\");",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "query Orders {\n  orders {\n    id\n    status\n    totalAmount\n    user {\n      email\n      role\n    }\n  }\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "11 - Update Order Status",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"Order status updated\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.updateOrderStatus.status).to.equal('CONFIRMED');",
                            "    console.log(\"âœ… Order status updated to CONFIRMED\");",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "mutation UpdateOrderStatus($id: ID!, $status: OrderStatus!) {\n  updateOrderStatus(id: $id, status: $status) {\n    id\n    status\n  }\n}",
                        "variables": "{\n  \"id\": \"{{order_id}}\",\n  \"status\": \"CONFIRMED\"\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "12 - Process Payment",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"Payment processed\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.processPayment).to.have.property('id');",
                            "    pm.expect(response.data.processPayment.status).to.equal('COMPLETED');",
                            "    pm.collectionVariables.set(\"payment_id\", response.data.processPayment.id);",
                            "    console.log(\"âœ… Payment processed:\", response.data.processPayment.id);",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "mutation ProcessPayment($input: ProcessPaymentInput!) {\n  processPayment(input: $input) {\n    id\n    amount\n    status\n  }\n}",
                        "variables": "{\n  \"input\": {\n    \"orderId\": \"{{order_id}}\",\n    \"paymentMethodId\": \"{{payment_method_id}}\",\n    \"amount\": 31.98\n  }\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "13 - Get All Payments (Admin)",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"All payments retrieved\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.payments).to.be.an('array');",
                            "    console.log(\"âœ… Retrieved\", response.data.payments.length, \"payments\");",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "query Payments {\n  payments {\n    id\n    amount\n    status\n    order {\n      id\n      user {\n        email\n      }\n    }\n  }\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "14 - Update User (Admin Operation)",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"User updated successfully\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.updateUser).to.have.property('id');",
                            "    console.log(\"âœ… User updated successfully\");",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "mutation UpdateUser($id: ID!, $isActive: Boolean) {\n  updateUser(id: $id, isActive: $isActive) {\n    id\n    isActive\n  }\n}",
                        "variables": "{\n  \"id\": \"{{user_id}}\",\n  \"isActive\": true\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "15 - Delete Menu Item (Cleanup)",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"Menu item deleted\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.deleteMenuItem).to.be.true;",
                            "    console.log(\"âœ… Menu item deleted\");",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "mutation DeleteMenuItem($id: ID!) {\n  deleteMenuItem(id: $id)\n}",
                        "variables": "{\n  \"id\": \"{{menu_item_id}}\"\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        },
        {
            "name": "16 - Delete Restaurant (Cleanup)",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test(\"Restaurant deleted\", function () {",
                            "    const response = pm.response.json();",
                            "    pm.expect(response.data.deleteRestaurant).to.be.true;",
                            "    console.log(\"âœ… Restaurant deleted\");",
                            "    console.log(\"\\nðŸŽ‰ Admin flow completed successfully!\");",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "body": {
                    "mode": "graphql",
                    "graphql": {
                        "query": "mutation DeleteRestaurant($id: ID!) {\n  deleteRestaurant(id: $id)\n}",
                        "variables": "{\n  \"id\": \"{{restaurant_id}}\"\n}"
                    }
                },
                "url": {
                    "raw": "{{graphql}}",
                    "host": ["{{graphql}}"]
                }
            }
        }
    ]
}
